<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Player</title>
    <script src="https://content.jwplatform.com/libraries/IDzF9Zmk.js"></script>
    <style>
        body { margin: 0; padding: 20px; background: #000; color: #fff; font-family: Arial, sans-serif; }
        #player, #embedPlayer { width: 100%; max-width: 800px; height: 400px; margin: 0 auto; }
        #embedPlayer { display: none; }
        .error { color: red; text-align: center; margin-top: 10px; }
        #player:empty::before { content: none; } /* Remove JW Player loading message */
    </style>
</head>
<body>
    <div id="player"></div> <!-- Empty div to avoid loading message -->
    <iframe id="embedPlayer" src="about:blank" frameborder="0" allowfullscreen allow="autoplay; fullscreen" sandbox="allow-same-origin allow-scripts"></iframe>
    <div id="error" class="error"></div>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const streamId = urlParams.get('play') || '60';
        const proxyUrl = `/api/proxy?id=${streamId}`;
        const errorDiv = document.getElementById('error');
        const embedPlayer = document.getElementById('embedPlayer');
        const jwPlayerContainer = document.getElementById('player');

        // Block popups by overriding window.open
        window.open = function() {
            console.log('Blocked popup attempt');
            return null;
        };

        fetch(proxyUrl)
            .then(response => {
                if (!response.ok) throw new Error('Stream fetch failed');
                return response.text();
            })
            .then(data => {
                if (data.includes('#EXTM3U')) { // Check if M3U8 playlist
                    embedPlayer.style.display = 'none';
                    jwPlayerContainer.style.display = 'block';
                    jwplayer('player').setup({
                        file: proxyUrl,
                        width: '100%',
                        height: '400px',
                        autostart: false,
                        controls: true
                    }).on('error', (e) => {
                        errorDiv.textContent = 'Error loading stream: ' + (e.message || 'Unknown error');
                    }).on('ready', () => {
                        errorDiv.textContent = '';
                    });
                } else { // Use iframe for embed URL
                    jwPlayerContainer.style.display = 'none';
                    embedPlayer.style.display = 'block';
                    embedPlayer.src = `https://thedaddy.to/embed/stream-${streamId}.php`;
                }
            })
            .catch(error => {
                errorDiv.textContent = 'Error fetching stream: ' + error.message;
                jwPlayerContainer.style.display = 'none';
                embedPlayer.style.display = 'block';
                embedPlayer.src = `https://thedaddy.to/embed/stream-${streamId}.php`;
            });
    </script>
</body>
</html>
